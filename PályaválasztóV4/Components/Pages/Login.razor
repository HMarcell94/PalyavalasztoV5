@page "/login"
@using Lib
@using PalyavalsztoV4.Models.V41
@layout NoSidebarLayoutLayout

<PageTitle>Login</PageTitle>
<div class="MultiGlassEffect" style="justify-content: center; text-align: center; border-top-right-radius: 20px; border-bottom-right-radius: 20px; border-top-left-radius: 0px; border-bottom-left-radius: 0px;justify-content: center; align-items: center; margin-top: 0px; width: 50%; height: 100vh;">
    <h2 style="margin-top: 30px; color: white; text-align: center; ">Bejelentkezés</h2>
    <RadzenLogin style="margin: auto; margin-top: 20%; width: 400px; height: 50vh; background-color: transparent; padding: auto;" Username="" ShowLoginButton="true" RememberMe="true" UserText="Email" Register=NavigateToRegistration Login="@(a => LoginMethod(a))">
        </RadzenLogin>
</div>

<div class="logopulse center-content">
    <RadzenImage @onclick="NavigateToMain" Path="favicon.ico" Style="justify-content: center; text-align: center; width: 150px; height: 150px;"></RadzenImage>
</div>

@code {

    void OnRegister(string name)
    {
        NavigationManager.NavigateTo("Registration");
    }

    private void NavigateToRegistration()
    {
        NavigationManager.NavigateTo("Registration");
    }
    private void NavigateToMain() //Főoldalra
    {
        NavigationManager.NavigateTo(" ");
    }

    private async Task LoginMethod(LoginArgs a)
    {
        using(NetworkClient c = new NetworkClient())
        {
            APIResponse<string> d = await c.PostAsync<UserLoginDto, APIResponse<string>>("/UserRegistrationLogin/login", new UserLoginDto()
                {
                    Email = a.Username,
                    Password = a.Password
                });
            if (d.StatusCode == 0)
            {
                TokenStore.Store(d.Data);
                this.NavigateToMain();
            } 
            else
            {
                this.NotificationService.Notify(NotificationSeverity.Error, "Hiba", "Valamilyen adatot nem megfelelően adott meg.");
            }
        }
    }
}